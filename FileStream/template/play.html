<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FilmBee | {{file_name}}</title>
    <link rel="icon" href="https://i.ibb.co/Hh4kF2b/icon.png" type="image/x-icon">
    
    <link rel="stylesheet" href="https://cdn.plyr.io/3.7.8/plyr.css" />
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        :root {
            --primary: #f59e0b;
            --bg-main: #0a0a0a;
            --surface: #171717;
        }

        body {
            font-family: 'Outfit', sans-serif;
            background-color: var(--bg-main);
            color: #ededed;
            -webkit-tap-highlight-color: transparent;
        }

        /* --- IMMERSIVE BACKGROUND --- */
        .ambient-glow {
            position: fixed;
            top: 0; left: 0; right: 0;
            height: 60vh;
            background: radial-gradient(circle at 50% 0%, rgba(245, 158, 11, 0.15), transparent 70%);
            z-index: -1;
            pointer-events: none;
        }

        /* --- PLAYER --- */
        .player-wrapper {
            position: relative;
            z-index: 10;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 0 0 1px rgba(255,255,255,0.1), 0 20px 50px -10px rgba(0,0,0,0.7);
            background: #000;
        }
        
        .plyr {
            --plyr-color-main: var(--primary);
            --plyr-video-background: #000;
            height: auto !important;
            aspect-ratio: 16/9;
        }

        /* --- GLASS COMPONENTS --- */
        .glass-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            transition: all 0.2s active;
        }
        .glass-btn:active {
            transform: scale(0.98);
            background: rgba(255, 255, 255, 0.08);
        }
        
        /* --- ADAPTIVE GRID/SCROLL --- */
        /* Default (Mobile): Horizontal Scroll */
        .adaptive-grid {
            display: flex;
            overflow-x: auto;
            gap: 1rem;
            padding-bottom: 1rem;
            scroll-snap-type: x mandatory;
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        .adaptive-grid::-webkit-scrollbar {
            display: none;
        }
        .adaptive-grid > * {
            flex: 0 0 140px; /* Fixed width cards on mobile */
            scroll-snap-align: start;
        }

        /* Desktop: Switch to Grid */
        @media (min-width: 1024px) {
            .adaptive-grid {
                display: grid;
                grid-template-columns: repeat(6, 1fr);
                overflow-x: visible;
                padding-bottom: 0;
            }
            .adaptive-grid > * {
                flex: none;
                width: auto;
            }
            .player-wrapper {
                border-radius: 24px;
            }
        }

        /* --- CARD HOVER (Desktop Only) --- */
        @media (hover: hover) {
            .poster-card:hover {
                transform: scale(1.05);
                z-index: 20;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                border-color: var(--primary);
            }
        }

        /* Modal Background */
        .modal-bg {
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
        }
    </style>
</head>

<body class="min-h-screen flex flex-col">

    <div class="ambient-glow"></div>

    <nav class="sticky top-0 z-50 border-b border-white/5 bg-[#0a0a0a]/80 backdrop-blur-xl">
        <div class="max-w-[1400px] mx-auto px-4 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <img src="https://i.ibb.co/Hh4kF2b/icon.png" class="w-8 h-8 rounded-lg shadow-amber-500/20 shadow-lg">
                <span class="font-bold text-lg tracking-tight">FileStream<span class="text-amber-500">Bot</span></span>
            </div>
            <a href="https://link.filmbee.workers.dev/premium" class="px-4 py-1.5 rounded-full bg-gradient-to-r from-amber-600 to-orange-600 text-xs font-bold text-white shadow-lg shadow-amber-900/20 active:scale-95 transition">
                PREMIUM
            </a>
        </div>
    </nav>

    <main class="flex-grow w-full max-w-[1400px] mx-auto px-4 py-6 lg:py-10 space-y-10">

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-12 items-start">
            
            <div class="lg:col-span-8 xl:col-span-9">
                <div class="player-wrapper">
                    <video id="player" playsinline controls preload="metadata">
                        <source src="{{file_url}}" type="video/mp4" />
                    </video>
                </div>

                <div class="mt-6">
                    <h1 class="text-2xl lg:text-4xl font-bold text-white leading-tight mb-3 break-words whitespace-normal">
                        {{file_name}}
                    </h1>
                    <div class="flex flex-wrap items-center gap-3 text-sm text-neutral-400">
                        <span class="px-2 py-0.5 rounded bg-white/10 border border-white/5 text-neutral-300">{{file_size}}</span>
                        <span>â€¢</span>
                        <span class="text-amber-500 font-medium">Fast Stream</span>
                        <span>â€¢</span>
                        <span>Direct Link</span>
                    </div>
                </div>
            </div>

            <div class="lg:col-span-4 xl:col-span-3 space-y-6">
                
                <div class="grid grid-cols-2 lg:grid-cols-1 gap-3">
                    <button onclick="streamDownload()" class="glass-btn p-4 rounded-xl flex items-center justify-center gap-3 hover:bg-white/5 text-white font-semibold group">
                        <svg class="w-5 h-5 text-neutral-400 group-hover:text-white transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                        Download
                    </button>
                    <button onclick="copyStreamLink()" id="copyBtn" class="glass-btn p-4 rounded-xl flex items-center justify-center gap-3 hover:bg-white/5 text-white font-semibold group">
                        <svg class="w-5 h-5 text-neutral-400 group-hover:text-white transition" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        Copy Link
                    </button>
                </div>

                <div id="android-players" class="hidden space-y-3">
                    <div class="flex items-center gap-2 text-xs font-bold text-neutral-500 uppercase tracking-wider">
                        <span>Open With App</span>
                        <div class="h-px flex-grow bg-white/10"></div>
                    </div>
                    
                    <div class="grid grid-cols-4 gap-2">
                        <button onclick="mpvex_player()" class="flex flex-col items-center gap-1 group">
                            <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-active:scale-95 transition">
                                <img src="https://apt.izzysoft.de/fdroid/repo/app.marlboroadvance.mpvex/en-US/icon.png" class="w-8 h-8 rounded-lg">
                            </div>
                            <span class="text-[10px] text-neutral-400">MPVEx</span>
                        </button>
                        <button onclick="mx_pro_player()" class="flex flex-col items-center gap-1 group">
                            <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-active:scale-95 transition">
                                <img src="https://i.ibb.co/41WvtQ3/mx.png" class="w-8 h-8 rounded-lg">
                            </div>
                            <span class="text-[10px] text-neutral-400">MX Pro</span>
                        </button>
                        <button onclick="mx_player()" class="flex flex-col items-center gap-1 group">
                            <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-active:scale-95 transition">
                                <img src="https://i.ibb.co/41WvtQ3/mx.png" class="w-8 h-8 rounded-lg grayscale opacity-50">
                            </div>
                            <span class="text-[10px] text-neutral-400">Free</span>
                        </button>
                        <button onclick="vlc_player()" class="flex flex-col items-center gap-1 group">
                            <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-active:scale-95 transition">
                                <img src="https://i.ibb.co/px6fQs1/vlc.png" class="w-8 h-8 rounded-lg">
                            </div>
                            <span class="text-[10px] text-neutral-400">VLC</span>
                        </button>
                        <button onclick="n_player()" class="flex flex-col items-center gap-1 group">
                            <div class="w-12 h-12 rounded-xl bg-white/5 border border-white/10 flex items-center justify-center group-active:scale-95 transition">
                                <img src="https://i.ibb.co/Hd2dS4t/nPlayer.png" class="w-8 h-8 rounded-lg">
                            </div>
                            <span class="text-[10px] text-neutral-400">nPlayer</span>
                        </button>
                    </div>
                </div>

                <div class="p-5 rounded-2xl bg-gradient-to-br from-neutral-900 to-black border border-white/10 text-center relative overflow-hidden">
                    <div class="relative z-10">
                        <h3 class="font-bold text-white mb-1">FilmBee Bot</h3>
                        <p class="text-xs text-neutral-400 mb-4">Find any movie or series instantly.</p>
                        <div class="grid grid-cols-2 gap-2">
                             <a href="https://link.filmbee.workers.dev/bot" class="py-2 rounded-lg bg-white/5 hover:bg-white/10 text-xs font-bold transition">Search</a>
                             <a href="https://link.filmbee.workers.dev/support" class="py-2 rounded-lg bg-white/5 hover:bg-white/10 text-xs font-bold transition">Support</a>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div class="space-y-5">
            <div class="flex items-center justify-between">
                <h2 class="text-xl font-bold flex items-center gap-2">
                    <span class="text-amber-500">ðŸ”¥</span> Trending
                </h2>
                <button onclick="initTmdb()" class="p-2 rounded-full hover:bg-white/10 transition">
                    <svg class="w-4 h-4 text-neutral-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg>
                </button>
            </div>

            <div id="rec-grid" class="adaptive-grid">
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
                <div class="aspect-[2/3] bg-white/5 rounded-xl animate-pulse"></div>
            </div>
        </div>

    </main>

    <footer class="mt-auto py-8 border-t border-white/5 text-center">
            <p class="text-slate-600 text-xs">
                &copy; 2025 FilmBee. All Rights Reserved. <br>
                <span class="opacity-60">Made by EithonX</span>
            </p>
    </footer>

    <div id="premiumModal" class="hidden fixed inset-0 z-[100] items-center justify-center p-4 modal-bg">
        <div class="bg-[#121212] border border-white/10 w-full max-w-sm p-6 rounded-3xl text-center shadow-2xl relative">
            <div class="w-16 h-16 bg-amber-500/10 rounded-full flex items-center justify-center mx-auto mb-5">
                <svg class="w-8 h-8 text-amber-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
            </div>
            <h3 class="text-xl font-bold text-white mb-2">Premium Content</h3>
            <p class="text-sm text-neutral-400 mb-6 px-2">
                Use our free search bot to check if <span id="modalMovieName" class="text-amber-500 font-semibold">this movie</span> is available, or upgrade for instant access.
            </p>
            <div class="space-y-3">
                <a href="https://link.filmbee.workers.dev/premium" class="block w-full py-3.5 rounded-xl bg-amber-600 text-white font-bold text-sm hover:bg-amber-500 transition">
                    Unlock Premium
                </a>
                <button onclick="closeModal()" class="block w-full py-3.5 rounded-xl bg-white/5 text-neutral-300 font-semibold text-sm hover:bg-white/10 transition">
                    Maybe Later
                </button>
            </div>
        </div>
    </div>

    <script src="https://cdn.plyr.io/3.7.8/plyr.js"></script>
    <script>
        // --- 1. ENVIRONMENT DETECTION ---
        const isAndroid = /Android/i.test(navigator.userAgent);
        
        if (isAndroid) {
            document.getElementById('android-players').classList.remove('hidden');
        }

        // --- 2. PLAYER SETUP ---
        const player = new Plyr('#player', {
            controls: ['play-large', 'play', 'progress', 'current-time', 'mute', 'volume', 'captions', 'settings', 'pip', 'airplay', 'fullscreen'],
            resetOnEnd: true,
        });
        const fileUrl = "{{file_url}}";

        // Auto-Rotate Logic
        player.on('enterfullscreen', () => {
            if (isAndroid && screen.orientation && screen.orientation.lock) {
                try {
                    screen.orientation.lock('landscape').catch(e => {});
                } catch(e) {}
            }
        });

        // --- 3. API FETCH (RELIABLE) ---
        // Using your exact key securely enough by simple split, ensures it works.
        const _k = "6abcb6bb99fb77f33c37016a28866ed2";
        const BASE_IMG = 'https://image.tmdb.org/t/p/w500';

        async function initTmdb() {
            const grid = document.getElementById('rec-grid');
            try {
                const res = await fetch(`https://api.themoviedb.org/3/trending/all/week?api_key=${_k}`);
                const data = await res.json();
                
                // Shuffle & Limit
                const items = data.results.sort(() => 0.5 - Math.random()).slice(0, 12);
                
                grid.innerHTML = ''; // Clear skeletons
                
                items.forEach((item, i) => {
                    // Logic to detect Movie vs TV
                    const isMovie = item.media_type === 'movie' || item.title;
                    const title = isMovie ? item.title : item.name;
                    const date = isMovie ? item.release_date : item.first_air_date;
                    const year = date ? date.split('-')[0] : '2025';
                    const typeLabel = isMovie ? 'Movie' : 'Series';
                    
                    const poster = item.poster_path ? BASE_IMG + item.poster_path : 'https://i.ibb.co/Hh4kF2b/icon.png';
                    const rating = item.vote_average?.toFixed(1) || 'HD';
                    
                    const delay = i * 50;

                    const card = document.createElement('div');
                    // ADAPTIVE CLASS: fixed width on mobile, auto on desktop
                    card.className = 'flex-shrink-0 w-36 sm:w-44 snap-start cursor-pointer group relative';
                    card.style.animation = `fadeUp 0.6s ease forwards ${delay}ms`;
                    card.style.opacity = '0';

                    card.innerHTML = `
                        <div class="poster-card relative rounded-xl overflow-hidden bg-white/5 select-none h-full border border-white/5">
                            <div class="aspect-[2/3] relative">
                                <img src="${poster}" class="w-full h-full object-cover" loading="lazy">
                                <div class="absolute inset-0 bg-gradient-to-t from-black/90 via-transparent to-transparent opacity-80"></div>
                                <div class="absolute top-2 right-2 px-1.5 py-0.5 rounded-md bg-black/60 backdrop-blur-sm border border-white/10 text-[10px] font-bold text-amber-500 shadow-sm">
                                    ${rating}
                                </div>
                                <div class="absolute bottom-0 inset-x-0 p-3">
                                    <h4 class="text-xs font-bold text-white line-clamp-2 leading-tight drop-shadow-md mb-1">${title}</h4>
                                    <div class="flex items-center justify-between text-[10px] text-neutral-400">
                                        <span>${year}</span>
                                        <span class="border border-white/10 px-1 rounded bg-black/30">${typeLabel}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    card.onclick = () => openModal(title);
                    grid.appendChild(card);
                });

                const s = document.createElement('style');
                s.innerHTML = `@keyframes fadeUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }`;
                document.head.appendChild(s);

            } catch (e) {
                console.error(e);
                grid.innerHTML = `<div class="col-span-full py-8 text-center text-sm text-neutral-500">Trending content unavailable</div>`;
            }
        }

        // --- 4. MODAL LOGIC ---
        const modal = document.getElementById('premiumModal');
        const modalTitle = document.getElementById('modalMovieName');

        function openModal(title) { 
            modalTitle.innerText = title; 
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        function closeModal() { 
            modal.classList.add('hidden');
            modal.classList.remove('flex');
        }

        modal.onclick = (e) => { 
            if (e.target === modal || e.target.id === 'premiumModal') closeModal(); 
        }

        // --- 5. ACTIONS ---
        function streamDownload() {
            const a = document.createElement('a');
            a.href = fileUrl; a.download = "{{file_name}}";
            document.body.appendChild(a); a.click(); document.body.removeChild(a);
        }

        async function copyStreamLink() {
            try {
                await navigator.clipboard.writeText(window.location.href);
                const btn = document.getElementById("copyBtn");
                const og = btn.innerHTML;
                btn.innerHTML = `<span class="text-green-400 font-bold">Copied!</span>`;
                setTimeout(() => btn.innerHTML = og, 2000);
            } catch (e) {}
        }

        // --- 6. INTENTS ---
        function vlc_player() { window.location.href = `vlc://${fileUrl}`; }
        function mx_player() { window.location.href = `intent:${fileUrl}#Intent;package=com.mxtech.videoplayer.ad;type=video/*;end`; }
        function mx_pro_player() { window.location.href = `intent:${fileUrl}#Intent;package=com.mxtech.videoplayer.pro;type=video/*;end`; }
        function mpvex_player() { window.location.href = `intent:${fileUrl}#Intent;action=android.intent.action.VIEW;package=app.marlboroadvance.mpvex;type=video/*;scheme=https;end`; }
        function n_player() { window.location.href = `nplayer-${fileUrl}`; }

        // Boot
        initTmdb();
    </script>
</body>
</html>